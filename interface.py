# -*- coding: utf-8 -*-
"""interface 0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1SASp312iTXGBGvi9v137TJDOUC-gHKei
"""

import streamlit as st
import pandas as pd
from io import BytesIO
from traitement_f13 import code_traitement_F13
from traitement_machines import code_traitement_machines

st.set_page_config(page_title="Classement Machines", layout="centered")

col1, col2 = st.columns([3, 1])

with col2:
    st.image("logo.png", width=700)

with col1:
  st.title("📊 Classement des données machines")
  st.write("Uploadez les fichiers ci-dessous pour générer le rapport.")

with st.sidebar :

  st.sidebar.title("📘 Mode d'emploi")
  st.sidebar.markdown("""
  1. Cliquer sur "Browse files" pour télécharger le fichier à traiter

  2. Cliquer sur "🧪 Lancer le traitement F13" ou "🧪 Lancer le traitement machines" pour traiter en fonction du F13 seulement ou de tous les types d'arrêts

  3. Cliquer sur "📥 Télécharger le fichier classé" pour l'enregistrer sur votre appareil.

  Le fichier contiendra :

  -Une feuille des données complètes

  -Un classement des machines par temps d'arrêt

  -Une feuille par machine

  -Un résumé des causes

  ⚠️ Cet outil n'enregistre pas les fichiers (il faut bien importer à chaque fois)

  """)

  with st.expander("A propos") :
    st.markdown("""

    J'ai mis au point cet outil dans le cadre d'un stage technicien à Michelin Blanzy du 10/06/2025 au 18/07/2025.

    Il a pour but de faciliter le traitement de données en permettant de créer un fichier complet classant les données à partir d'un fichier excel récupéré sur MicroStrategy.

    Si vous voulez me remercier pour la création de ce merveilleux outil, voici mon RIB : FR76 1080 7004 6942 4196 7298 767


    Benoît GUENIN, étudiant en deuxième année à l'Icam Toulouse

    """)

# Téléversement du fichier principal
uploaded_file = st.file_uploader("📁 Fichier", type=["xlsx"])


if uploaded_file:
    if st.button("🧪 Lancer le traitement F13"):
        with st.spinner("Traitement en cours..."):

            fichier_F13 = code_traitement_F13(uploaded_file)

            st.success("✅ Traitement terminé !")
            st.download_button(
                label="📥 Télécharger le fichier classé",
                data=fichier_F13.getvalue(),
                file_name="Impact_F13.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
    if st.button("🧪 Lancer le traitement machines"):
        with st.spinner("Traitement en cours..."):

            fichier_machines = code_traitement_machines(uploaded_file)

            st.success("✅ Traitement terminé !")
            st.download_button(
                label="📥 Télécharger le fichier classé",
                data=fichier_machines.getvalue(),
                file_name="Impact_machines.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
else:
    st.info("Veuillez téléverser le fichier pour commencer.")